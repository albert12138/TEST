// ==UserScript==
// @name         New Userscript
// @namespace    http://tampermonkey.net/
// @version      2024-01-04
// @description  try to take over the world!
// @author       You
// @match        http*://*.jxjypt.cn/*
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @grant        none
// @require      https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.js
// ==/UserScript==


console.log('æ‚¨å·²è¿›å…¥é«˜ç­‰ç»§ç»­æ•™è‚²ç½‘')
init()

//åˆå§‹åŒ–å…ƒç´ 
function init() {
  //åˆ›å»ºæŒ‰é’®å…ƒç´ 
  craeateButtonElement();
  //åˆ›å»ºæ¶ˆæ¯æç¤ºå…ƒç´ 
  craeateMsgElement();
  //è¯¾ç¨‹å­¦ä¹ ç›‘å¬è‡ªåŠ¨å±•å¼€
  setCatalogueClickMonitor();
}

//åˆ›å»ºæŒ‰é’®å…ƒç´ 
function craeateButtonElement() {
  let btnParam = {
    ele: document.createElement('div'),
    css: "display: flex;" +
      "cursor: pointer;" +
      "position: fixed;" +
      "right:40px;" +
      "top: 100px;" +
      "background: #aaa;" +
      "width: 50px;" +
      "height: 50px;" +
      "z-index:1000;" +
      "border-radius: 100%;",
    iconcss: "margin: auto;" +
      "width: 35px;" +
      "height: 35px;" +
      "line-height: 35px;" +
      "background: #fff;" +
      "animation:kite 5s infinite;" +
      "text-align: center;" +
      "font-size: 22px;" +
      "border-radius: 100%;"
  };

  document.querySelector('body').appendChild(((ele) => {
    ele.id = 'sloth-topic';
    // æ·»åŠ å…è®¸æ‹–æ‹½å±æ€§
    ele.setAttribute('draggable',true)
    ele.innerHTML = '<div style="' + btnParam.iconcss + '">ğŸ¶ğŸ¦¥</div>';
    ele.style.cssText = btnParam.css;
    return ele;
  })(btnParam.ele));

  //åŠ¨æ€åˆ›å»ºkeyframesåŠ¨ç”»
  //document.styleSheets[0].insertRule(`@keyframes kite{100%{transform:rotate(360deg);}}`,0)
  const style = document.createElement('style')
  style.appendChild(document.createTextNode(`@keyframes kite{100%{transform:rotate(360deg);}}`));
  document.getElementById('sloth-topic').appendChild(style);
  // æ‹–æ‹½äº‹ä»¶
  document.getElementById('sloth-topic').addEventListener('dragend', function(e) {
    e.stopPropagation()
    const btn = document.getElementById('sloth-topic');
    if (e.target.style['right'] > 0) e.target.style['right'] = 0
    btn.style.cssText += btnParam.css + `left:${e.clientX}px;top:${e.clientY}px;`;
  });
  //æŒ‰é’®ç‚¹å‡»æ“ä½œ
  document.getElementById("sloth-topic").addEventListener("click", function () {
    start();
  });
}

//åˆ›å»ºæ¶ˆæ¯å…ƒç´ 
function craeateMsgElement() {
  let msgParam = {
    ele: document.createElement('div'),
    css: "background: rgba(0,0,0,0.6);" +
      "position: fixed;" +
      "inset: 0px;" +
      "margin: auto;" +
      "padding: 10px;" +
      "border-radius: 5px;" +
      "color: #fff;" +
      "font-size: 18px;" +
      "letter-spacing: 1.5px;" +
      "display: none;" +
      "z-index: 99999;"
  };
  document.querySelector('body').appendChild(((ele) => {
    ele.id = 'sloth-msg';
    ele.innerHTML = '';
    ele.style.cssText = msgParam.css;
    return ele;
  })(msgParam.ele));
}

//æ¶ˆæ¯æç¤º
function msg(msg, timeout = 2500) {
  document.getElementById('sloth-msg').style.display = 'inline-table';
  document.getElementById('sloth-msg').innerHTML = msg;
  setTimeout(() => {
    document.getElementById('sloth-msg').style.display = 'none';
  }, timeout);
}


//ç‚¹å‡»å¼€å§‹æŒ‰é’®
function start() {
    //è‡ªåŠ¨å±•å¼€ç­”æ¡ˆ
    var zkjxs = document.getElementsByClassName('zkjx')
    for (let i = 0; i < zkjxs.length; i++)
    {
        zkjxs[i].click()

    }
    if(zkjxs.length>1){
        msg('ç­”æ¡ˆè§£æå·²å±•å¼€å®Œæ¯•',6000)
    }
}

//è¯¾ç¨‹å­¦ä¹ ç›‘å¬è‡ªåŠ¨å±•å¼€
function setCatalogueClickMonitor() {
    var courses = document.getElementsByClassName('z-gery-icon');
    if(courses.length==0){
        return;
    }
    let tablecon = document.getElementsByClassName("course")[0];
    tablecon.onclick = function (event) {
        var ele = event.target;
        if(event.target.className=='z-gery-icon z-color z-class-icon'){
           setTimeout(() => {
               msg('------------- ä»¥ä¸ºæ‚¨è‡ªåŠ¨å±•å¼€ç­”æ¡ˆè§£æ -------------')
               $(ele).parent().parent().parent().parent().find('.zkjx').click()
           }, 1000);
        }
    }
}



(function() {
    'use strict';
    $(()=>{
        console.log("start")
        start()
        setTimeout(() => {
            let i = 1
            //console.log($('.solution').text())
            //console.log($('.sub-answer sub-picon-no clearfix ').text())
            $('.sub-content').each(function (index, element) {
                let str=$(element).text().toString()
                let a = str.indexOf('ç­”æ¡ˆè§£æï¼šæš‚æ— ')
                let b = str.indexOf('å‚è€ƒç­”æ¡ˆï¼š')
                let answ = $(element).find('.e__textarea')
                answ.val(str.slice((b+5),a))
                console.log(answ)
            });
            $('.sub-content').each(function (index, element) {
                // element == this

                let option = $(element).find('.sub-answer dd')
                let str=$(element).text().toString()
                option.each(function (ind, ele) {
                    // element == this
                    let an = $(ele).attr('data-value')
                    if (str.indexOf('ç­”æ¡ˆè§£æï¼šæš‚æ— ')-str.indexOf('å‚è€ƒç­”æ¡ˆï¼š')==7){
                        if(an==str[str.indexOf('å‚è€ƒç­”æ¡ˆï¼š')+5]){
                            $(ele).click()
                            return false
                        }

                    }
                    else{
                        for(let i=0;i<(str.indexOf('ç­”æ¡ˆè§£æï¼šæš‚æ— ')-str.indexOf('å‚è€ƒç­”æ¡ˆï¼š')-6);i++){
                            if(an==str[str.indexOf('å‚è€ƒç­”æ¡ˆï¼š')+5+i]){
                                $(ele).click()

                            }
                        }
                    }
                });


                str.indexOf('å‚è€ƒç­”æ¡ˆï¼š')
                str.indexOf('ç­”æ¡ˆè§£æï¼šæš‚æ— ')
                //option.click()

                //console.log(str.indexOf('ç­”æ¡ˆè§£æï¼šæš‚æ— ')-str.indexOf('å‚è€ƒç­”æ¡ˆï¼š'))
                //console.log(str.charAt(option.text()))
                i++

            });

        }, 5000);

    })
    msg('ç­”æ¡ˆå®Œæ¯•',6000)
    // Your code here...
})();
